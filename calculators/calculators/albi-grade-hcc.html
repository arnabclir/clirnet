<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALBI Grade - HCC Survival Estimate</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            padding-top: 20px;
            padding-bottom: 40px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .container { max-width: 800px; }

        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 25px;
            border: none;
        }

        .card-header h3 {
            margin: 0;
            font-weight: 700;
            font-size: 24px;
        }

        .card-header small {
            display: block;
            margin-top: 8px;
            opacity: 0.95;
        }

        .card-body { padding: 30px; }

        .form-group { margin-bottom: 20px; }

        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-control, .form-select {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 16px;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }

        .btn-calculate {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            color: white;
        }

        .btn-back {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }

        .btn-back:hover {
            background: white;
            color: var(--primary-color);
        }

        .result-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-left: 4px solid var(--primary-color);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .result-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .interpretation {
            font-size: 16px;
            color: #333;
            margin-top: 10px;
            line-height: 1.6;
        }

        .formula-box {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #555;
        }

        .hidden { display: none; }

        .alert {
            border-radius: 8px;
            border: none;
        }

        .alert-info {
            background-color: rgba(102, 126, 234, 0.15);
            color: #333;
            border-left: 4px solid var(--primary-color);
        }

        .grade-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin-top: 10px;
            font-size: 14px;
        }

        .grade-1 { background-color: #d4edda; color: #155724; }
        .grade-2 { background-color: #fff3cd; color: #856404; }
        .grade-3 { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Back button navigation -->
        <a href="index.html" class="btn-back">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>

        <!-- Main calculator card -->
        <div class="card">
            <!-- Card header with title -->
            <div class="card-header">
                <h3><i class="fas fa-flask"></i> ALBI Grade</h3>
                <small>Albumin-Bilirubin Grade - HCC Prognostication</small>
            </div>

            <!-- Card body with form and results -->
            <div class="card-body">
                <!-- Information alert -->
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i>
                    <strong>Clinical Information:</strong> The ALBI (Albumin-Bilirubin) grade is a simple prognostic system for hepatocellular carcinoma based on serum albumin and bilirubin levels. It predicts survival and guides treatment decisions.
                </div>

                <!-- Laboratory values section -->
                <h5 class="mt-4 mb-3"><i class="fas fa-flask"></i> Laboratory Values</h5>

                <!-- Serum albumin -->
                <div class="form-group">
                    <label for="albumin" class="form-label">
                        <i class="fas fa-flask-vial"></i> Serum Albumin (g/dL)
                    </label>
                    <input type="number" class="form-control" id="albumin" min="1" max="6" step="0.1" placeholder="Enter value (normal 3.5-5.5)">
                    <small class="form-text text-muted">Reference range: 3.5-5.5 g/dL</small>
                </div>

                <!-- Serum bilirubin -->
                <div class="form-group">
                    <label for="bilirubin" class="form-label">
                        <i class="fas fa-flask-vial"></i> Total Serum Bilirubin (mg/dL)
                    </label>
                    <input type="number" class="form-control" id="bilirubin" min="0.1" max="20" step="0.1" placeholder="Enter value (normal <1.2)">
                    <small class="form-text text-muted">Reference range: <1.2 mg/dL (direct <0.3 mg/dL)</small>
                </div>

                <!-- Tumor and treatment section -->
                <h5 class="mt-4 mb-3"><i class="fas fa-stethoscope"></i> HCC Characteristics</h5>

                <!-- HCC stage/treatment -->
                <div class="form-group">
                    <label for="hccStage" class="form-label">
                        <i class="fas fa-flag"></i> HCC Stage/Treatment Status
                    </label>
                    <select class="form-select" id="hccStage">
                        <option value="">Select...</option>
                        <option value="early">Early stage (suitable for curative treatment)</option>
                        <option value="intermediate">Intermediate stage (TACE candidates)</option>
                        <option value="advanced">Advanced stage (systemic therapy)</option>
                        <option value="end">End-stage (palliative care)</option>
                    </select>
                </div>

                <!-- Calculate button -->
                <button class="btn btn-calculate" onclick="calculateALBI()">
                    <i class="fas fa-calculator"></i> Calculate ALBI Grade & Prognosis
                </button>

                <!-- Results section -->
                <div id="results" class="hidden">
                    <div class="result-box">
                        <strong style="font-size: 18px;"><i class="fas fa-chart-pie"></i> ALBI Prognostication</strong>

                        <!-- ALBI Score -->
                        <div>
                            <h5 style="margin-top: 15px; color: #333;">ALBI Score</h5>
                            <div class="result-value" id="albiScore">-</div>
                            <small style="color: #666;">Formula: (log₁₀ bilirubin × 0.66) + (albumin × -0.085)</small>
                        </div>

                        <!-- ALBI Grade -->
                        <div style="margin-top: 15px;">
                            <h5 style="color: #333;">ALBI Grade</h5>
                            <div class="result-value" id="albiGrade" style="font-size: 28px;">-</div>
                        </div>

                        <!-- Median overall survival -->
                        <div style="margin-top: 15px;">
                            <h5 style="color: #333;">Median Overall Survival</h5>
                            <div class="result-value" id="medianOS" style="font-size: 24px;">-</div>
                        </div>

                        <!-- ALBI interpretation -->
                        <div class="interpretation" id="albiInterpretation" style="margin-top: 15px;"></div>

                        <!-- Grade badge -->
                        <div id="gradeBadge"></div>

                        <!-- Recommendations section -->
                        <div style="margin-top: 20px; background-color: #f0f8ff; padding: 15px; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                            <strong><i class="fas fa-stethoscope"></i> Clinical Recommendations:</strong>
                            <ul style="margin-bottom: 0; margin-top: 10px; font-size: 14px;">
                                <li id="rec1"></li>
                                <li id="rec2"></li>
                                <li id="rec3"></li>
                            </ul>
                        </div>

                        <!-- Formula and methodology -->
                        <div class="formula-box">
                            <strong>ALBI Calculation Formula:</strong><br>
                            ALBI Score = (log₁₀ bilirubin × 0.66) + (albumin × -0.085)<br><br>
                            <strong>ALBI Grading:</strong><br>
                            Grade 1: ALBI ≤ -2.60 (median OS ~14 months)<br>
                            Grade 2: -2.60 < ALBI ≤ -0.64 (median OS ~5-7 months)<br>
                            Grade 3: ALBI > -0.64 (median OS ~1-2 months)<br><br>
                            <strong>Model Details:</strong><br>
                            - Independent predictor of HCC survival<br>
                            - Incorporates hepatic synthetic function and cholestasis<br>
                            - Useful for treatment selection and prognostication<br>
                            - Applicable to all HCC stages<br>
                            - Can be combined with TNM staging for better risk stratification
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ALBI calculation function
        function calculateALBI() {
            // Input validation
            const albumin = parseFloat(document.getElementById('albumin').value);
            const bilirubin = parseFloat(document.getElementById('bilirubin').value);
            const hccStage = document.getElementById('hccStage').value;

            // Validate required fields
            if (isNaN(albumin) || isNaN(bilirubin) || !hccStage) {
                alert('Please fill in all required fields');
                return;
            }

            // Validate ranges
            if (albumin < 0.5 || albumin > 6) {
                alert('Albumin must be between 0.5 and 6 g/dL');
                return;
            }

            if (bilirubin < 0.1 || bilirubin > 20) {
                alert('Bilirubin must be between 0.1 and 20 mg/dL');
                return;
            }

            // Calculate ALBI score using formula
            // ALBI = (log10 Bili × 0.66) + (Alb × -0.085)
            const logBilirubin = Math.log10(bilirubin);
            const albiScore = (logBilirubin * 0.66) + (albumin * -0.085);

            // Determine ALBI grade
            let albiGrade = '';
            let medianOS = '';
            let survivalMonths = '';

            if (albiScore <= -2.60) {
                albiGrade = '1';
                survivalMonths = '14 months';
            } else if (albiScore <= -0.64) {
                albiGrade = '2';
                survivalMonths = '6-7 months';
            } else {
                albiGrade = '3';
                survivalMonths = '1-2 months';
            }

            medianOS = survivalMonths;

            // Display results
            document.getElementById('albiScore').textContent = albiScore.toFixed(2);
            document.getElementById('albiGrade').textContent = 'Grade ' + albiGrade;
            document.getElementById('medianOS').textContent = survivalMonths;

            // Interpretation and recommendations
            let interpretation = '';
            let gradeClass = '';
            let recommendations = [];

            if (albiGrade === '1') {
                interpretation = 'ALBI Grade 1 (Favorable): Good hepatic synthetic function. Median overall survival approximately 14 months. Candidate for curative or aggressive locoregional therapies.';
                gradeClass = 'grade-1';
                recommendations = [
                    'Aggressive treatment approach feasible',
                    'Curative intent options: resection, transplantation, or ablation',
                    'Regular surveillance with imaging and biomarkers (AFP)'
                ];
            } else if (albiGrade === '2') {
                interpretation = 'ALBI Grade 2 (Intermediate): Moderately impaired hepatic function. Median overall survival 6-7 months. Locoregional therapy options should be considered.';
                gradeClass = 'grade-2';
                recommendations = [
                    'Consider locoregional therapy (TACE, HAIC, or systemic therapy)',
                    'Assess transplant candidacy if resection not feasible',
                    'Close monitoring for hepatic decompensation'
                ];
            } else {
                interpretation = 'ALBI Grade 3 (Unfavorable): Poor hepatic synthetic function. Median overall survival 1-2 months. Limited treatment options; consider palliative care and systemic therapy with caution.';
                gradeClass = 'grade-3';
                recommendations = [
                    'Systemic therapy (sorafenib, lenvatinib, atezolizumab + bevacizumab)',
                    'Focus on symptom management and supportive care',
                    'Palliative care consultation recommended'
                ];
            }

            document.getElementById('albiInterpretation').textContent = interpretation;

            // Add grade badge
            const badgeText = 'ALBI GRADE ' + albiGrade;
            document.getElementById('gradeBadge').innerHTML = `<span class="grade-badge ${gradeClass}">${badgeText}</span>`;

            // Display recommendations
            recommendations.forEach((rec, index) => {
                document.getElementById(`rec${index + 1}`).textContent = rec;
            });

            // Show results
            document.getElementById('results').classList.remove('hidden');
        }
    </script>
</body>
</html>
